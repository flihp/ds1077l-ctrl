.PHONY : all clean test

PREFIX = ds1077l

COMMON_OBJ = ${PREFIX}.o
COMMON_SRC = ${PREFIX}.h ${PREFIX}.c

BUS_BIN = ${PREFIX}-bus
BUS_OBJ = ${PREFIX}-bus.o
BUS_SRC = ${PREFIX}-bus.c ${PREFIX}-bus.h ${PREFIX}.h

DIV_BIN = ${PREFIX}-div
DIV_OBJ = ${PREFIX}-div.o
DIV_SRC = ${PREFIX}-div.c ${PREFIX}-div.h

PREFIX_MUX = ${PREFIX}-mux
MUX_OBJ = ${PREFIX_MUX}.o
MUX_SRC = ${PREFIX_MUX}.c ${PREFIX_MUX}.h
PREFIX_MUX_SET = ${PREFIX}-mux-set
MUXSET_BIN = ${PREFIX_MUX_SET}
MUXSET_OBJ = ${PREFIX_MUX_SET}.o
MUXSET_SRC = ${PREFIX_MUX_SET}.c ${PREFIX_MUX_SET}.h

BUSTEST_BIN = ${PREFIX}-bus_test
BUSTEST_OBJ = ${BUSTEST_BIN}.o
BUSTEST_SRC = ${BUSTEST_BIN}.c

DIVTEST_BIN = ${PREFIX}-div_test
DIVTEST_OBJ = ${DIVTEST_BIN}.o
DIVTEST_SRC = ${DIVTEST_BIN}.c

MUXTEST_BIN = ${PREFIX}-mux_test
MUXTEST_OBJ = ${MUXTEST_BIN}.o
MUXTEST_SRC = ${MUXTEST_BIN}.c

BINS = ${BUS_BIN} ${DIV_BIN} ${MUXSET_BIN}
OBJS = ${COMMON_OBJ} ${DIVSET_OBJ} ${MUXSET_OBJ} \
       ${BUSTEST_OBJ} ${DIVTEST_OBJ} ${MUXTEST_OBJ} ${BUS_OBJ} ${DIV_OBJ} \
       ${MUX_OBJ}
TESTS = ${BUSTEST_BIN} ${DIVTEST_BIN} ${MUXTEST_BIN}

all : ${BINS} ${TESTS}
clean :
	rm -f ${BINS} ${OBJS} ${TESTS}
test : ${TESTS}

${COMMON_OBJ} : ${COMMON_SRC}

${BUS_BIN} : ${COMMON_OBJ} ${BUS_OBJ}

${DIV_OBJ} : ${DIV_SRC}
${DIV_BIN} : ${COMMON_OBJ} ${DIV_OBJ}

${MUXSET_OBJ} : ${MUXSET_SRC}
${MUXSET_BIN} : ${COMMON_OBJ} ${MUXSET_OBJ} ${MUX_OBJ}

${BUSTEST_OBJ} : ${BUSTEST_SRC} ${PREFIX}.h
${BUSTEST_BIN} : ${BUSTEST_OBJ}

${DIVTEST_OBJ} : ${DIVTEST_SRC} ${PREFIX}.h
${DIVTEST_BIN} : ${DIVTEST_OBJ}

${MUXTEST_OBJ} : ${MUXTEST_SRC} ${PREFIX}.h
${MUXTEST_BIN} : ${MUXTEST_OBJ} ${COMMON_OBJ}

