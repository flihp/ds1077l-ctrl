.PHONY : all clean test

PREFIX = ds1077l

COMMON_OBJ = ${PREFIX}.o
COMMON_SRC = ${PREFIX}.h ${PREFIX}.c

BUSSET_BIN = ${PREFIX}-bus-set
BUSSET_OBJ = ${PREFIX}-bus-set.o
BUSSET_SRC = ${PREFIX}-bus-set.c ${PREFIX}-bus-set.h

DIV_OBJ = ${PREFIX}-div.o
DIV_SRC = ${PREFIX}-div.c ${PREFIX}-div.h
DIVSET_BIN = ${PREFIX}-div-set
DIVSET_OBJ = ${PREFIX}-div-set.o
DIVSET_SRC = ${PREFIX}-div-set.c ${PREFIX}-div-set.h ${PREFIX}-div.h

PREFIX_MUX = ${PREFIX}-mux-set
MUXSET_BIN = ${PREFIX_MUX}
MUXSET_OBJ = ${PREFIX_MUX}.o
MUXSET_SRC = ${PREFIX_MUX}.c ${PREFIX_MUX}.h

DUMP_BIN = ${PREFIX}-dump
DUMP_OBJ = ${DUMP_BIN}.o
DUMP_SRC = ${DUMP_BIN}.c

BUSTEST_BIN = ${PREFIX}-bus_test
BUSTEST_OBJ = ${BUSTEST_BIN}.o
BUSTEST_SRC = ${BUSTEST_BIN}.c

DIVTEST_BIN = ${PREFIX}-div_test
DIVTEST_OBJ = ${DIVTEST_BIN}.o
DIVTEST_SRC = ${DIVTEST_BIN}.c

MUXTEST_BIN = ${PREFIX}-mux_test
MUXTEST_OBJ = ${MUXTEST_BIN}.o
MUXTEST_SRC = ${MUXTEST_BIN}.c

BINS = ${BUSSET_BIN} ${DIVSET_BIN} ${MUXSET_BIN} ${DUMP_BIN}
OBJS = ${COMMON_OBJ} ${BUSSET_OBJ} ${DIVSET_OBJ} ${MUXSET_OBJ} ${DUMP_OBJ} \
       ${BUSTEST_OBJ} ${DIVTEST_OBJ} ${MUXTEST_OBJ} ${DIV_OBJ}
TESTS = ${BUSTEST_BIN} ${DIVTEST_BIN} ${MUXTEST_BIN}

all : ${BINS} ${TESTS}
clean :
	rm -f ${BINS} ${OBJS} ${TESTS}
test : ${TESTS}

${COMMON_OBJ} : ${COMMON_SRC}

${BUSSET_OBJ} : ${BUSSET_SRC}
${BUSSET_BIN} : ${COMMON_OBJ} ${BUSSET_OBJ}

${DIVSET_OBJ} : ${DIVSET_SRC}
${DIVSET_BIN} : ${COMMON_OBJ} ${DIVSET_OBJ} ${DIV_OBJ}

${MUXSET_OBJ} : ${MUXSET_SRC}
${MUXSET_BIN} : ${COMMON_OBJ} ${MUXSET_OBJ}

${DUMP_OBJ} : ${DUMP_SRC} ${PREFIX}.h
${DUMP_BIN} : ${DUMP_OBJ} ${COMMON_OBJ} ${DIV_OBJ}

${BUSTEST_OBJ} : ${BUSTEST_SRC} ${PREFIX}.h
${BUSTEST_BIN} : ${BUSTEST_OBJ}

${DIVTEST_OBJ} : ${DIVTEST_SRC} ${PREFIX}.h
${DIVTEST_BIN} : ${DIVTEST_OBJ}

${MUXTEST_OBJ} : ${MUXTEST_SRC} ${PREFIX}.h
${MUXTEST_BIN} : ${MUXTEST_OBJ} ${COMMON_OBJ}

